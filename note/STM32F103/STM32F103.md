# STM32F103
## 项目
### 打卡机log
- 2024/3/27
  - 成功连接手机热点。
  - 成功与连接手机热点的电脑进行通讯。但只能接收电脑的信息（而且有错误），不能成功发送。
- 2024/3/28
  - 奇怪，连不上电脑了。【解决，大概是因为连着校园网然后手机开热点。】
  - 实现了电脑与板子基于ESP32通过TCP进行连接并透传。
  - 关闭透传的时候需要等一会，因为快速进行的话，会与后面的语句相连，一起通过串口传给电脑，就无法关闭了。
  - 获取时间
    - AT+CIPSTART="TCP","api.k780.com",80
    - GET http://api.k780.com:88/?app=life.time&appkey=10003&sign=b59bc3ef6191eb9f747dd4e83c99f2a4&format=json&HTTP/1.1\r\n
  - 延迟大概1秒
- 2024/5/14
  - 放弃了拿板子变成跟ESP32通讯，还是电脑直接CH340串口直接通讯吧。
- 2024/5/15
  - 今天电脑连CH340，CH340连Wifi模块，对WiFi模块的AT指令进行了学习。
  - 成果1：在串口助手中，连WiFi然后进入透传，退出透传已经调通。（一般AT指令需要勾选上“新行”，退出透传需要取消勾选“新行”）。用的网络调试助手来尽心通讯。
  - 下一步是将网络调试助手换为自己写的程序。
- 2024/5/16
  - 今天测试了一下自己写的服务器程序。很多问题
    - 1、两者传输中文的编码不一样。
      - debug: 将服务器端编码方式改为GB2312编码。
    - 2、8266传输给服务器中文后，就无法继续传输了。
      - bug: string = bytes.decode(data, encoding)
      - debug: encoding='GB2312'
    - 3、服务器传输给8266的中文会乱码。
      - debug: send_string.encode(encoding)
    - 4、服务器传输的数据无法换行。（string后加0D0A）
      - debug: send_string = input() + '\r\n'
- 2024/5/17
  - 功能上还有不足。
    - 1、需要维持一张表，记录员工信息，每个员工对应一个ID。
    - 2、当网络未连接时，需要将已打卡信息存储在设备本地，待网络恢复后再对打卡数据进行上传。
    - 3、
## ATK-MW8266D
### 设备特性
- 通电后，会自动连接上次连接的AP（Access Point，无线接入点）设备。
- 服务器程序杀死后，重启服务器，会自动连上已8266建立的TCP连接。
### 连接WiFi流程
- AT+RESTORE, ready, 恢复出厂设置
- AT, OK, AT测试
- AT+CWMODE=1, OK, 设置为Station模式
- AT+RST, OK, 软件复位生效
- ATE0, OK, 关闭回显功能
- AT+CWJAP="Mi 11","@&$qwe123", WIFI GOT IP, 连接WIFI
- AT+CIPMUX=0, OK, 开启单连接
- AT+CIFSR, OK, 获取IP地址
- AT+CIPSTART="TCP","192.168.105.93",8088, CONNECT, 连接服务器
- AT+CIPMODE=1, OK, 设置透传模式
- AT+CIPSEND, >, 进入透传模式
- +++, 退出透传模式，至少间隔一秒发送下一条AT指令
- AT+CIPCLOSE, OK, 关闭TCP连接
### AT指令
- 硬件连接：电脑USB插上CH340串口模块，CH340与ATK-MW使用杜邦线连接
- 模式
  - STA 模式。在此模式下， ATK-MW8266D 模块可连接其他设备提供的无线网络， 例如通过 WIFI 连接至路由器， 从而可以访问互联网，进而实现手机或电脑通过互联网实现对设备的远程控制。
  - AP 模式。AP 模式为默认的模式，在此模式下， ATK-MW8266D 模块将作为热点供其他设备连接，从而让手机或电脑直接与模块进行通讯，实现局域网的无线控制。
  - STA+AP 模式。该模式为STA模式与AP模式共存的一种模式， ATK-MW8266D 模块既能连接至其他设备提供的无线网络，又能作为热点，供其他设备连接，以实现广域网与局域网的无缝切换，方便操作使用。
- 基本AT命令
  - AT: 测试 AT 启动
  - AT+RST: 重启模块
  - AT+GMR: 查看版本信息
  - ATEx: 开关回显功能(0关闭, 1开启)
  - AT+RESTORE: 恢复出厂设置
  - AT+UART: UART配置
    - 查询指令： AT+UART?
    - 设置指令： AT+UART=115200,8,1,0,0
- WiFi功能AT指令
  - 1. 设置 WIFI 模式（STA、 AP、 STA+AP）
    - 测试指令： AT+CWMODE=?
    - 查询指令： AT+CWMODE?
    - 设置指令： AT+CWMODE=x
      - x=1, STA
      - x=2, AP
      - x=3, STA+AP
  - 2. 连接AP
    - 查询指令： AT+CWJAP?（连接后才有）
    - 设置指令： AT+CWJAP=<ssid>,<pwd>[,<bssid>]
      - <ssid>： 目标 AP 的 SSID
      - <pwd>： 目标 AP 的密码
      - [<bssid>]： 目标 AP 的 MAC 地址
  - 3. 扫描附近的 AP 信息
    - 配置： AT+CWLAP=<ssid>[,<mac>,<ch>]
    - 执行： AT+CWLAP
  - 4. 断开AP连接
    - AT+CWQAP
  - 5. 设置AP模式的配置
    - 查询指令： AT+CWSAP?
    - 设置指令： 